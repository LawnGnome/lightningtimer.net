<!DOCTYPE HTML>
<html>
<head>
<title>Lightning Timer</title>
<!-- 
  Originally By Simon Willison - http://simonwillison.net/2008/Nov/12/lightning/ 
  Additional changes by Tim 'mithro' Ansell - http://blog.mithis.net/
-->
<script type="text/javascript">
// Default settings: 5 minutes, warning at 1 minute
var count = 5 * 60;
var warning = 60;

function settime() {
    // Can optionally set count and warning in the url
    // e.g. http://www.lightningtimer.net/#30,15 = 30 seconds, warning at 15
    //      http://www.lightningtimer.net/#300 = 5 minutes, no warning
    var match = /(\d+),?(\d+)?/.exec(location.hash);
    if (match && match[1]) {
        count = parseInt(match[1], 10);
    }
    if (match && match[2]) {
        warning = parseInt(match[2], 10);
    }
    if (match && !match[2]) {
        warning = -1; // Disable warning
    }
}

if ("onhashchange" in window) {
    window.onhashchange = settime;
}

window.onload = function() {
    settime();

    document.getElementById('countdown').onclick = function() {
        this.onclick = null;
        countdown();
    }
    document.getElementById('countdown').style.cursor = 'pointer';
};

function countdown() {
    if (count > 0) {
        document.getElementById('countdown').style.cursor = '';
        var obj = document.getElementById("countdown");
        obj.replaceChild(
            document.createTextNode(count.toMinutesAndSeconds()),
            obj.firstChild
        );
        document.title = count.toMinutesAndSeconds(); 
        count--;
        if (count < warning) {
            document.body.className = 'warning';
        }
        window.setTimeout(countdown, 1000);

        // Since we've already decremented the count, we're looking for zero
        // for the last "frame" before the deadline.
        if (count == 0) {
            window.setTimeout(function () {
                document.getElementById("foot").className = "drop";
            }, 700);
        } else if (count == 2) {
            document.getElementById("music").play();
        }
    } else {
        document.body.className = 'deadline';
        var obj = document.getElementById("countdown");
        obj.replaceChild(
            document.createTextNode(count.toMinutesAndSeconds()),
            obj.firstChild
        );
        document.title = count.toMinutesAndSeconds();
        obj.onclick = function() {
            location.reload();
        };
        obj.style.cursor = 'pointer';
    }
}
Number.prototype.toMinutesAndSeconds = function() {
    // convert numeric seconds input to minutes and seconds string output
    var nn, curTime = new Date(this * 1000);
    return nn = curTime.getMinutes() + ":" + (
        ((nn = curTime.getSeconds()) < 10) ? "0" + nn : nn
    );
}
</script>
<style type="text/css">
body {
    text-align: center;
    font-family: verdana;
    font-weight: bold;
    font-size: 20em;
    color: white;
    background-color: black;
}
body.warning {
    background-color: pink;
    color: black;
}
body.deadline {
    text-decoration: blink;
    background-color: red;
    color: white;
}
#foot {
    position: absolute;
    width: 100vw;
    bottom: 100vh;
    left: 0;
    transition: bottom 300ms linear;
    pointer-events: none;
}
#foot.drop {
    bottom: 0;
}
#music {
    display: none;
}
</style>
</head>
<body>
<body class="start">

<span id="countdown">Start</span>

<img src="Monty_python_foot.png" id="foot">
<audio id="music" preload="auto" src="liberty_bell_march.mp3">

</body>
</html>
<!-- vim: set et ts=4 sw=4: -->
